---
layout: post
title: '除了今日头条，还有哪些APP会被通报整改？'
date: 2021-07-01
tags:
  今日头条
  data-science
  projects
---

![](https://enpei-md.oss-cn-hangzhou.aliyuncs.com/img20210716222449.png?x-oss-process=style/wp)

本文视频教程：[YouTube](https://www.youtube.com/watch?v=lqpObIe-sM8&t=9s) | [B站](https://www.bilibili.com/video/BV1Wq4y1s7XU)

本文相关代码、数据：[点击这里](https://github.com/enpeizhao/data-science/tree/main/projects/android_malware_analysis)



```python
print('😀😀😀 导入依赖库')
# 导入库
import pandas as pd
from IPython.display import display
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

# retina screen
%config InlineBackend.figure_format = 'retina' #set 'png' here when working on notebook
%matplotlib inline
```

    😀😀😀 导入依赖库



```python
# 加载训练数据（通报的软件）详情
training_app_data = pd.read_csv("./traning_app_list.csv")
print('😀😀😀 加载训练数据')
```

    😀😀😀 加载训练数据



```python
# 加载测试数据（排行榜软件）详情
test_app_data = pd.read_csv("./test_app_list.csv")
print('😀😀😀 加载测试数据')
```

    😀😀😀 加载测试数据



```python
# 查看大小
print('😀😀😀 训练数据大小：'+ str(training_app_data.shape))
print('😀😀😀 测试数据大小：'+ str(test_app_data.shape))
```

    😀😀😀 训练数据大小：(144, 10)
    😀😀😀 测试数据大小：(796, 10)



```python
# 预览前3条数据
training_app_data.head(3)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>app_name</th>
      <th>app_version</th>
      <th>app_store_url</th>
      <th>icon_url</th>
      <th>size</th>
      <th>cate_str</th>
      <th>android_req_version</th>
      <th>permission_str</th>
      <th>privacy</th>
      <th>developer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>虎牙直播</td>
      <td>8.14.25</td>
      <td>https://m.wandoujia.com/apps/2180653/history_v...</td>
      <td>https://android-artworks.25pp.com/fs08/2021/05...</td>
      <td>101.46</td>
      <td>影音播放,视频,直播,</td>
      <td>5</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>https://hd.huya.com/huyaDIYzt/6811/pc/index.ht...</td>
      <td>广州虎牙信息科技有限公司</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Keep</td>
      <td>7.2.1</td>
      <td>https://m.wandoujia.com/apps/6607993/history_v...</td>
      <td>https://android-artworks.25pp.com/fs08/2021/05...</td>
      <td>66.60</td>
      <td>健康运动,减肥健身,</td>
      <td>5</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>http://www.gotokeep.com/privacy.html</td>
      <td>北京卡路里科技有限公司</td>
    </tr>
    <tr>
      <th>2</th>
      <td>一直播</td>
      <td>3.5.7</td>
      <td>https://m.wandoujia.com/apps/6760442/history_v181</td>
      <td>https://android-artworks.25pp.com/fs08/2021/03...</td>
      <td>72.82</td>
      <td>影音播放,直播,</td>
      <td>4.3.x</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>https://www.yizhibo.com/</td>
      <td>小咖秀（北京）科技有限公司</td>
    </tr>
  </tbody>
</table>
</div>




```python
test_app_data.head(3)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>app_name</th>
      <th>app_version</th>
      <th>app_store_url</th>
      <th>icon_url</th>
      <th>size</th>
      <th>cate_str</th>
      <th>android_req_version</th>
      <th>permission_str</th>
      <th>privacy</th>
      <th>developer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>淘宝</td>
      <td>10.1.0</td>
      <td>https://m.wandoujia.com/apps/32267</td>
      <td>https://android-artworks.25pp.com/fs08/2021/06...</td>
      <td>158.27</td>
      <td>网上购物,商城,</td>
      <td>4.0.2</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>https://terms.alicdn.com/legal-agreement/terms...</td>
      <td>淘宝（中国）软件有限公司</td>
    </tr>
    <tr>
      <th>1</th>
      <td>微信</td>
      <td>8.0.6</td>
      <td>https://m.wandoujia.com/apps/596157</td>
      <td>https://android-artworks.25pp.com/fs08/2021/05...</td>
      <td>179.24</td>
      <td>通讯社交,聊天,</td>
      <td>5</td>
      <td>修改您的通讯录,读取您的通讯录,勿扰模式使用权限,请求忽略电池优化,请求安装文件包,卸载快捷...</td>
      <td>http://weixin.qq.com/cgi-bin/readtemplate?lang...</td>
      <td>腾讯</td>
    </tr>
    <tr>
      <th>2</th>
      <td>抖音</td>
      <td>16.3.0</td>
      <td>https://m.wandoujia.com/apps/7461948</td>
      <td>https://android-artworks.25pp.com/fs08/2021/06...</td>
      <td>112.11</td>
      <td>摄影图像,相机,短视频,</td>
      <td>4.1.x</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>https://www.douyin.com/agreements/?id=67739011...</td>
      <td>北京微播视界科技有限公司</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 将privacy不为空的改为1
training_app_data.loc[training_app_data[training_app_data['privacy']!='0'].index.tolist(),'privacy'] = 1
test_app_data.loc[test_app_data[test_app_data['privacy']!='0'].index.tolist(),'privacy'] = 1

# 扔掉用不到的列

# APP版本
training_app_data.drop("app_version", axis = 1, inplace = True)
# 商城地址，无意义
training_app_data.drop("app_store_url", axis = 1, inplace = True)
# 图标地址，无意义
training_app_data.drop("icon_url", axis = 1, inplace = True)
# 安卓最低版本
training_app_data.drop("android_req_version", axis = 1, inplace = True)
# 开发者
training_app_data.drop("developer", axis = 1, inplace = True)



# APP版本
test_app_data.drop("app_version", axis = 1, inplace = True)
# 商城地址，无意义
test_app_data.drop("app_store_url", axis = 1, inplace = True)
# 图标地址，无意义
test_app_data.drop("icon_url", axis = 1, inplace = True)
# 安卓最低版本
test_app_data.drop("android_req_version", axis = 1, inplace = True)
# 开发者
test_app_data.drop("developer", axis = 1, inplace = True)


print('😀😀😀 已去除training/test data中版本、商城地址、图标地址、安卓最低版本、开发者字段')
```

    😀😀😀 已去除training/test data中版本、商城地址、图标地址、安卓最低版本、开发者字段



```python
# 切割字符，取类别和权限合集

# 类别、权限、需要取两份数据的合集

cate_group = []
permission_group = []


for index,row in training_app_data.iterrows():
    
    cate_str =  row['cate_str']
    cate_list = cate_str.split(',')[:-1]
    
    permission_str =  row['permission_str']
    permission_list  = permission_str.split(',')[:-1]
    
    # 取合集
    cate_group = list(set(cate_list).union(set(cate_group)))
    permission_group = list(set(permission_list).union(set(permission_group)))

    
for index,row in test_app_data.iterrows():
    
    cate_str =  row['cate_str']
    cate_list = cate_str.split(',')[:-1]
    
    permission_str =  row['permission_str']
    permission_list  = permission_str.split(',')[:-1]
    
    # 取合集
    cate_group = list(set(cate_list).union(set(cate_group)))
    permission_group = list(set(permission_list).union(set(permission_group)))

print('😀😀😀 已处理training/test data中分类和所需权限字符串，并生成相应词典')
```

    😀😀😀 已处理training/test data中分类和所需权限字符串，并生成相应词典



```python
# 将切割后的类别和权限增加进列（构造新特征），并初始化值为0

# 类别
cate_dict = {}
# 权限
permission_dict = {}


for index,val in enumerate(cate_group): 
    cols_name = 'category-'+str(index)
    cate_dict[val] = cols_name
    # 增加一列：分类
    training_app_data[cols_name] = 0
    test_app_data[cols_name] = 0

for index,val in enumerate(permission_group):  
    cols_name = 'permission-'+str(index)
    permission_dict[val] = cols_name
    # 增加一列：权限
    training_app_data[cols_name] = 0
    test_app_data[cols_name] = 0    

print('😀😀😀 已构造新特征，并初始化为0')    
```

    😀😀😀 已构造新特征，并初始化为0



```python
# 遍历每行数据，重新根据类别和权限实际字符，将对应类别标志为1

for index,row in training_app_data.iterrows():


    cate_str =  row['cate_str']
    cate_list = cate_str.split(',')[:-1]
    
    permission_str =  row['permission_str']
    permission_list  = permission_str.split(',')[:-1]
    
    # 取交集，赋值
    common_cate = list( set(cate_list).intersection(set(cate_group)))
    
    for cate_name in common_cate:
        
        training_app_data.loc[index,cate_dict[cate_name] ] = 1

    common_permission = list( set(permission_list).intersection(set(permission_group)))
    
    for permission_name in common_permission:
        training_app_data.loc[index,permission_dict[permission_name]] = 1
    

    
for index,row in test_app_data.iterrows():


    cate_str =  row['cate_str']
    cate_list = cate_str.split(',')[:-1]
    
    permission_str =  row['permission_str']
    permission_list  = permission_str.split(',')[:-1]
    
    # 取交集，赋值
    common_cate = list( set(cate_list).intersection(set(cate_group)))
    
    for cate_name in common_cate:
        
        test_app_data.loc[index,cate_dict[cate_name] ] = 1

    common_permission = list( set(permission_list).intersection(set(permission_group)))
    
    for permission_name in common_permission:
        test_app_data.loc[index,permission_dict[permission_name]] = 1
    

print('😀😀😀 新特征已重新赋值')  
```

    😀😀😀 新特征已重新赋值



```python
training_app_data.head(3)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>app_name</th>
      <th>size</th>
      <th>cate_str</th>
      <th>permission_str</th>
      <th>privacy</th>
      <th>category-0</th>
      <th>category-1</th>
      <th>category-2</th>
      <th>category-3</th>
      <th>category-4</th>
      <th>...</th>
      <th>permission-152</th>
      <th>permission-153</th>
      <th>permission-154</th>
      <th>permission-155</th>
      <th>permission-156</th>
      <th>permission-157</th>
      <th>permission-158</th>
      <th>permission-159</th>
      <th>permission-160</th>
      <th>permission-161</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>虎牙直播</td>
      <td>101.46</td>
      <td>影音播放,视频,直播,</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Keep</td>
      <td>66.60</td>
      <td>健康运动,减肥健身,</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>一直播</td>
      <td>72.82</td>
      <td>影音播放,直播,</td>
      <td>添加或修改日历活动，并在所有者不知情的情况下向邀请对象发送电子邮件,读取日历活动和机密信息,...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 260 columns</p>
</div>




```python
# 记录一下APP名称，待会要删除掉
vicious_app_group = training_app_data['app_name']
rank_app_group = test_app_data['app_name']
```


```python
# 再扔掉多余字段

# 使用过
training_app_data.drop("cate_str", axis = 1, inplace = True)
# 使用过
training_app_data.drop("permission_str", axis = 1, inplace = True)
# APP名称
training_app_data.drop("app_name", axis = 1, inplace = True)



# 使用过
test_app_data.drop("cate_str", axis = 1, inplace = True)
# 使用过
test_app_data.drop("permission_str", axis = 1, inplace = True)
# APP名称
test_app_data.drop("app_name", axis = 1, inplace = True)


print('😀😀😀 已去除training/test data中多余字段')
```

    😀😀😀 已去除training/test data中多余字段



```python
# 再次检查
training_app_data.head(3)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>size</th>
      <th>privacy</th>
      <th>category-0</th>
      <th>category-1</th>
      <th>category-2</th>
      <th>category-3</th>
      <th>category-4</th>
      <th>category-5</th>
      <th>category-6</th>
      <th>category-7</th>
      <th>...</th>
      <th>permission-152</th>
      <th>permission-153</th>
      <th>permission-154</th>
      <th>permission-155</th>
      <th>permission-156</th>
      <th>permission-157</th>
      <th>permission-158</th>
      <th>permission-159</th>
      <th>permission-160</th>
      <th>permission-161</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>101.46</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>66.60</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.82</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 257 columns</p>
</div>




```python
test_app_data.tail(3)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>size</th>
      <th>privacy</th>
      <th>category-0</th>
      <th>category-1</th>
      <th>category-2</th>
      <th>category-3</th>
      <th>category-4</th>
      <th>category-5</th>
      <th>category-6</th>
      <th>category-7</th>
      <th>...</th>
      <th>permission-152</th>
      <th>permission-153</th>
      <th>permission-154</th>
      <th>permission-155</th>
      <th>permission-156</th>
      <th>permission-157</th>
      <th>permission-158</th>
      <th>permission-159</th>
      <th>permission-160</th>
      <th>permission-161</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>793</th>
      <td>5.22</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>794</th>
      <td>3.80</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>795</th>
      <td>18.29</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 257 columns</p>
</div>




```python
# 查看排名前30的特征
training_top_features = pd.Series.sort_values(training_app_data.sum(axis=0), ascending=False)[1:30]
test_top_features = pd.Series.sort_values(test_app_data.sum(axis=0), ascending=False)[1:30]
```


```python
# 训练数据前30的特征
index_list = []
for index_val in training_top_features.index:
    
    index_list.append(list(permission_dict.keys())[list(permission_dict.values()).index(index_val)])

pd.Series(training_top_features.tolist(), index =index_list)
```




    完全的网络访问权限          144.0
    查看网络连接             144.0
    查看WLAN连接           144.0
    修改或删除您的SD卡中的内容     143.0
    读取您的SD卡中的内容        143.0
    防止手机休眠             140.0
    读取手机状态和身份          139.0
    拍摄照片和视频            138.0
    控制振动               138.0
    请求安装文件包            137.0
    连接WLAN网络和断开连接      133.0
    检索正在运行的应用          131.0
    更改网络连接性            130.0
    大致位置（基于网络）         129.0
    精确位置（基于GPS和网络）     127.0
    在其他应用之上显示内容        122.0
    录音                 119.0
    开机启动               115.0
    与蓝牙设备配对            112.0
    访问SD卡文件系统          112.0
    更改您的音频设置           109.0
    修改系统设置             109.0
    控制闪光灯               88.0
    查阅敏感日志数据            85.0
    访问蓝牙设置              77.0
    获取额外的位置信息提供程序命令     77.0
    安装快捷方式              67.0
    关闭其他应用              64.0
    对正在运行的应用重新排序        64.0
    dtype: float64




```python
# 测试数据前30的特征
index_list = []
for index_val in test_top_features.index:
    
    index_list.append(list(permission_dict.keys())[list(permission_dict.values()).index(index_val)])

pd.Series(test_top_features.tolist(), index =index_list)
```




    完全的网络访问权限          796.0
    查看网络连接             795.0
    查看WLAN连接           792.0
    读取您的SD卡中的内容        789.0
    修改或删除您的SD卡中的内容     788.0
    读取手机状态和身份          748.0
    防止手机休眠             714.0
    请求安装文件包            700.0
    拍摄照片和视频            660.0
    控制振动               660.0
    连接WLAN网络和断开连接      651.0
    检索正在运行的应用          617.0
    更改网络连接性            609.0
    大致位置（基于网络）         602.0
    精确位置（基于GPS和网络）     582.0
    在其他应用之上显示内容        555.0
    录音                 524.0
    修改系统设置             513.0
    访问SD卡文件系统          509.0
    开机启动               481.0
    与蓝牙设备配对            434.0
    更改您的音频设置           419.0
    控制闪光灯              350.0
    查阅敏感日志数据           346.0
    获取额外的位置信息提供程序命令    316.0
    访问蓝牙设置             258.0
    关闭其他应用             249.0
    对正在运行的应用重新排序       243.0
    直接拨打电话号码           234.0
    dtype: float64




```python
# 查看排名前30的特征
fig, axs =  plt.subplots(figsize=(15, 8),nrows=2, sharex=True)
pd.Series.sort_values(training_app_data.sum(axis=0), ascending=False)[1:30].plot.bar(ax=axs[0],color="gray")
pd.Series.sort_values(test_app_data.sum(axis=0), ascending=False)[1:30].plot.bar(ax=axs[1],color="blue")
```




    <matplotlib.axes._subplots.AxesSubplot at 0x7f8dc2d00e50>



![](https://enpei-md.oss-cn-hangzhou.aliyuncs.com/img20210716222520.png?x-oss-process=style/wp)



```python

```


```python
corrmat = training_app_data.corr()
f, ax = plt.subplots(figsize=(12, 9))
sns.heatmap(corrmat, vmax=.8, square=True,cmap='YlGnBu');
```


```python
corrmat = test_app_data.corr()
f, ax = plt.subplots(figsize=(12, 9))
sns.heatmap(corrmat, vmax=.8, square=True,cmap='YlGnBu');
```


```python

```


```python

import numpy as np
import matplotlib.pyplot as plt
import matplotlib.font_manager
from sklearn import svm


X_train = training_app_data
X_test = test_app_data
# fit the model
clf = svm.OneClassSVM(nu=0.03, kernel="rbf", gamma='auto')
clf.fit(X_train)
y_pred_train = clf.predict(X_train)
y_pred_test = clf.predict(X_test)

n_error_train = y_pred_train[y_pred_train == -1].size
n_error_test = y_pred_test[y_pred_test == -1].size
# n_error_outliers = y_pred_outliers[y_pred_outliers == 1].size

```


```python
# 根据decision_function挑选出最可能有问题的前30个APP（正数示为同一类，负数表示不为同一类）
dicision_arr = clf.decision_function(X_test)

d = {'app_name': rank_app_group, 'decision_value': dicision_arr}
df = pd.DataFrame(data=d)

cls_a_result = df[df['decision_value']>0].sort_values(by='decision_value', ascending=False)
```


```python
cls_a_result[:30]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>app_name</th>
      <th>decision_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>85</th>
      <td>照片恢复大师</td>
      <td>0.040956</td>
    </tr>
    <tr>
      <th>727</th>
      <td>猫小帅儿歌</td>
      <td>0.039363</td>
    </tr>
    <tr>
      <th>365</th>
      <td>雷电安全卫士</td>
      <td>0.035170</td>
    </tr>
    <tr>
      <th>527</th>
      <td>手机极速清理管家</td>
      <td>0.034865</td>
    </tr>
    <tr>
      <th>603</th>
      <td>月亮听书</td>
      <td>0.034647</td>
    </tr>
    <tr>
      <th>559</th>
      <td>聊天神器</td>
      <td>0.034477</td>
    </tr>
    <tr>
      <th>715</th>
      <td>书耽耽美小说</td>
      <td>0.033948</td>
    </tr>
    <tr>
      <th>208</th>
      <td>蒲公英联机平台</td>
      <td>0.033214</td>
    </tr>
    <tr>
      <th>513</th>
      <td>剑鱼标讯</td>
      <td>0.033001</td>
    </tr>
    <tr>
      <th>671</th>
      <td>截图拼接</td>
      <td>0.032982</td>
    </tr>
    <tr>
      <th>230</th>
      <td>快漫画大全</td>
      <td>0.032591</td>
    </tr>
    <tr>
      <th>223</th>
      <td>快乐小游戏</td>
      <td>0.032585</td>
    </tr>
    <tr>
      <th>166</th>
      <td>耽美小说大全</td>
      <td>0.032568</td>
    </tr>
    <tr>
      <th>358</th>
      <td>一键转发朋友圈</td>
      <td>0.032312</td>
    </tr>
    <tr>
      <th>422</th>
      <td>闹钟</td>
      <td>0.032302</td>
    </tr>
    <tr>
      <th>510</th>
      <td>手机智能省电管家</td>
      <td>0.032128</td>
    </tr>
    <tr>
      <th>127</th>
      <td>狗语翻译器</td>
      <td>0.032087</td>
    </tr>
    <tr>
      <th>119</th>
      <td>雷神加速器</td>
      <td>0.031462</td>
    </tr>
    <tr>
      <th>430</th>
      <td>大吉日历</td>
      <td>0.031462</td>
    </tr>
    <tr>
      <th>668</th>
      <td>PS修图</td>
      <td>0.031008</td>
    </tr>
    <tr>
      <th>476</th>
      <td>作业帮手</td>
      <td>0.031007</td>
    </tr>
    <tr>
      <th>299</th>
      <td>懒饭</td>
      <td>0.030790</td>
    </tr>
    <tr>
      <th>154</th>
      <td>果盘游戏</td>
      <td>0.030523</td>
    </tr>
    <tr>
      <th>333</th>
      <td>快速充电加速</td>
      <td>0.030370</td>
    </tr>
    <tr>
      <th>524</th>
      <td>阳光守护-家长版</td>
      <td>0.030335</td>
    </tr>
    <tr>
      <th>689</th>
      <td>发型设计</td>
      <td>0.029898</td>
    </tr>
    <tr>
      <th>264</th>
      <td>我的世界双层皮肤3D</td>
      <td>0.029576</td>
    </tr>
    <tr>
      <th>684</th>
      <td>特种作业人员考试</td>
      <td>0.029218</td>
    </tr>
    <tr>
      <th>544</th>
      <td>爱加速代理IP</td>
      <td>0.029169</td>
    </tr>
    <tr>
      <th>316</th>
      <td>IGXE</td>
      <td>0.029070</td>
    </tr>
  </tbody>
</table>
</div>




```python
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
from sklearn.neighbors import LocalOutlierFactor


X_train = training_app_data
X_test = test_app_data

# fit the model for novelty detection (novelty=True)
clf = LocalOutlierFactor(n_neighbors=30, novelty=True, contamination=0.1)
clf.fit(X_train)
# DO NOT use predict, decision_function and score_samples on X_train as this
# would give wrong results but only on new unseen training_app_data (not used in X_train),
# e.g. X_test, X_outliers or the meshgrid
X_scores = clf.negative_outlier_factor_

y_pred_test = clf.predict(X_test)
n_error_test = y_pred_test[y_pred_test == -1].size
```


```python
# 根据decision_function挑选出最可能有问题的前30个APP（正数示为同一类，负数表示不为同一类）
dicision_arr = clf.decision_function(X_test)

d = {'app_name': rank_app_group, 'decision_value': dicision_arr}
df = pd.DataFrame(data=d)

cls_b_result = df[df['decision_value']>0].sort_values(by='decision_value', ascending=False)
```


```python
cls_b_result[:30]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>app_name</th>
      <th>decision_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>71</th>
      <td>淘宝联盟</td>
      <td>0.203603</td>
    </tr>
    <tr>
      <th>47</th>
      <td>淘特</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>723</th>
      <td>巫溪网</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>766</th>
      <td>钢琴块块6</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>443</th>
      <td>西子湖畔</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>186</th>
      <td>聊天恢复精灵</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>459</th>
      <td>相寓</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>286</th>
      <td>夜聊</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>600</th>
      <td>陀螺多多</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>536</th>
      <td>优米</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>210</th>
      <td>北京移动手机营业厅</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>449</th>
      <td>Artand</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>695</th>
      <td>随手记</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>357</th>
      <td>一直娱</td>
      <td>0.201176</td>
    </tr>
    <tr>
      <th>677</th>
      <td>答题赚钱</td>
      <td>0.200977</td>
    </tr>
    <tr>
      <th>625</th>
      <td>时间相机</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>243</th>
      <td>钢琴教练</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>602</th>
      <td>我的公主城堡世界</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>721</th>
      <td>闪电盒子</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>327</th>
      <td>小目标打卡</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>36</th>
      <td>QQ同步助手</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>190</th>
      <td>陌陌约会</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>413</th>
      <td>闪电新闻</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>284</th>
      <td>摩托车驾考题库</td>
      <td>0.200192</td>
    </tr>
    <tr>
      <th>705</th>
      <td>马鞍山OK论坛</td>
      <td>0.200024</td>
    </tr>
    <tr>
      <th>771</th>
      <td>小黑盒</td>
      <td>0.200024</td>
    </tr>
    <tr>
      <th>157</th>
      <td>图怪兽</td>
      <td>0.200024</td>
    </tr>
    <tr>
      <th>475</th>
      <td>WindLink</td>
      <td>0.200024</td>
    </tr>
    <tr>
      <th>579</th>
      <td>给到</td>
      <td>0.200024</td>
    </tr>
    <tr>
      <th>447</th>
      <td>快手搞笑</td>
      <td>0.199402</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 两个模型预测共同结果
result_arr = list(set(cls_a_result.app_name.values.tolist()).intersection(cls_b_result.app_name.values.tolist()))
result_arr[:30]
```




    ['我的世界双层皮肤3D',
     '截图拼接',
     '指尖水务',
     '小黑盒',
     '藏宝阁',
     'WiFi众联钥匙',
     '维也纳酒店',
     '雷电安全卫士',
     'MAKA设计',
     '到位',
     '电e宝',
     '懒人猜歌',
     '书香小说大全',
     '美易',
     '映客直播',
     '日日顺快线司机端',
     '玩洽',
     '作业帮手',
     '中国网',
     '极速PDF阅读器',
     '快手搞笑',
     '观众网',
     '星座',
     '零基础英语学习',
     '万物心选',
     '听车汽修版',
     '批量视频转换',
     '京东金融',
     '陀螺多多',
     '动态壁纸']




```python
print('😀😀😀 两个模型预测共同结果共有 {num} 个'.format(num=len(result_arr)))
```

    😀😀😀 两个模型预测共同结果共有 440 个



